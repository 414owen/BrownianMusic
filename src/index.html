
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>MusicMap</title>
</head>
<!-- <script async src="https://use.fontawesome.com/2926a1b865.js"></script> -->
<link async href="//fonts.googleapis.com/css?family=Raleway:300" rel="stylesheet" type="text/css">
<script src="//owenowen.netsoc.ie/nutmeg/nutmeg.js"></script>
<script>

// Pegasus HTTP library, from https://github.com/typicode/pegasus
function pegasus(a,b){return b=new XMLHttpRequest,b.open("GET",a),a=[],b.onreadystatechange=b.then=function(c,d,e,f){if(c&&c.call&&(a=[,c,d]),4==b.readyState&&(e=a[0|b.status/200])){try{f=JSON.parse(b.responseText)}catch(g){f=null}e(f,b)}},b.send(),b}

function getNewArtist(name, id) {
	return {name: name, related: [], gotRelated: false, relatedOnScreen: 0};
}

var graph = [
/*
	{
		name: 'example',
		x: 0,
		y: 0,
		getRelated: function() {...}
	},
*/
];

// Backends, to 
function spotify(idparam) {

	function getNewArtist(idparam) {
		return {
			id: idparam,
			related: [],
			relatedOnScreen: 0
		};
	}

	function addNewArtist(id) {
		if (this.artists[id] === undefined) {
			this.artists[id] = getNewArtist(name, id);
		}
	}

	this.artists = {
		/*

		sdfej3bncc: {
			gotRelated: false,
			related: ["sdwefijh33","dfe3gh3e3q"],
			relatedOnScreen: 2
		}

		*/
	};

	function onNodeAdd(parentID, childID) {
		
	}

	// Callback takes a list of names, and a function of what to do on node Add
	this.search = function(artist, callback) {
		var request = pegasus('https://api.spotify.com/v1/search?q=' + encodeURI(artist) + '&type=artist');
		request.then(function(results) {
			callback(results.map(function(related) {return related.name;}), function(index, nodeCallback, onNodeAdd) {
				// When artist with *index parameter* is chosen
				var chosen = related[index];
				addNewArtist(chosen.id);
				var node = {name: chosen.name};
				node.getRelated = function() {}
			});
		});
	};

	this.getRelated = function(id, callback) {
		var artist = this.artists[id];
		if (!artist.gotRelated) {
			var request = pegasus('https://api.spotify.com/v1/artists/' + encodeURI(id) + '/related-artists');
			request.then(function(related) {
				var artist = related.map(function(artist) {return getNewArtist(artist.name, artist.id);});
			});
		}
	};
};

nutmeg().global();

window.onload = function() {
	var ratio = window.devicePixelRatio || 1;
	// var canvas = canvas();
	// var context = canvas.val.getContext('2d');
    body().style(style.body)(
        div().style(style.center)(
            input('Hello World').style(style.input),
            div('-->').style(style.button)
        )
    );
};

var foreground = '#ddd';
var background = '#333';

var style = mergeStyle({
    transition: {
        transition: 'all 0.3s linear'
    },
    button: {
    	depends: ['input', 'clickable']
    },
    padded: {
    	padding: '1rem'
    },
    margined: {
    	margin: '1rem'
    },
    bordered: {
    	border: '1px solid ' + foreground
    },
    clickable: {
    	cursor: 'pointer'
    },
    input: {
    	depends: ['base', 'bordered', 'padded'],
    	backgroundColor: foreground,
    	color: background,
    	focused: {
    		backgroundColor: 'grey'
    	},
    	active: {
    		backgroundColor: 'red'
    	}
    },
    base: {
        border: '0',
        color: foreground,
        margin: '0',
        padding: '0',
        fontFamily: 'Raleway',
        fontSize: '1rem',
        fontWeight: '300',
        lineHeight: '1.15',
        display: 'block'
    },
    icon: {
        depends: ['transition'],
        fontSize: '2rem',
        width: '4rem',
        height: '3.5rem',
        lineHeight: '3.5rem',
        hover: {
            fontSize: '2.5rem',
            color: background,
            backgroundColor: foreground
        }
    },
    body: {
        depends: ['base', 'fill'],
        position: 'absolute',
        backgroundColor: background
    },
    fill: {
        width: '100%',
        height: '100%'
    },
    flex: {
        display: 'flex'
    },
    centerHor: {
        depends: ['fill', 'flex'],
        justifyContent: 'center',
        textAlign: 'center'
    },
    center: {
        depends: ['centerHor'],
        alignItems: 'center'
    },
    hline: {
        depends: ['lower'],
        borderTop: '1px solid'
    },
    lower: {
        marginTop: '0.5rem'
    }
});

</script>
<body>
	
</body>
</html>
